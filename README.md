# RevSpell Converter (TFS RevScript)

RevSpell Converter reads `spells.xml` from a TFS-based server and generates modern RevScript Lua files. It preserves original combat logic when available and wraps it into a clean `Spell("instant"|"rune")` interface.

## Features

- XML parsing for `instant` and `rune` entries
- Duplicate words handling by merging vocations
- ID rules
  - Runes use XML `itemID`
  - Normal and conjuring spells use sequential IDs starting from a base (default `100`)
- Output structure
  - `converter/runes/{group}/...`
  - `converter/spells/{group}/...`
  - `converter/conjuring/...`
- Lua generation
  - Keeps original Lua combat on top and calls `combat:execute(creature, var)`
  - Adds required spell configs (group, id, name, words, level, mana, vocations)
  - Applies defaults when missing (`cooldown`, `groupCooldown`)
  - Reads XML flags like `needWeapon`, `casterTargetOrDirection`, `blockwalls`, `range`
- UI
  - Dark theme
  - Language toggle `PT/EN`
  - Full table with Words, Premium, Range, Cooldown, Script
  - Preview shows the original callback when available
 - TFS version selector for compatible outputs

## TFS Version Support

The converter supports generating RevScript for multiple TFS variants via a version selector:

- TFS 1.4.2 (1098)
- TFS 1.5 Nekiro Standard
- TFS 1.4.2 / 1.5 Custom (Downgrade/Nekiro)

Behavior by mode:
- 1.5 Milhtore/Downgrade (Standard):
  - Generates `spell:id(...)`
  - No `spell:spellId(...)`
  - No `spell:groupCooldown(...)`
- 1.5 Nekiro Standard:
  - Generates `spell:id(...)`
  - Adds `spell:groupCooldown(...)`
  - No `spell:spellId(...)`
- 1.4.2 / 1.5 Custom:
  - Generates `spell:id(...)`
  - Generates `spell:spellId(...)`
  - Adds `spell:groupCooldown(...)`

Wrapper signature:
- Always emits `function spell.onCastSpell(creature, variant, isHotkey) return combat:execute(creature, variant) end`
- Legacy `onCastSpell(...)` is removed from the original Lua to avoid duplication

Example (Custom mode):
```lua
-- generated by Spell Converter
-- original script
local combat = Combat()
-- ...

local spell = Spell("instant")

function spell.onCastSpell(creature, variant, isHotkey) return combat:execute(creature, variant) end

spell:group("attack")
spell:id(100)
spell:spellId(100)
spell:name("Berserk")
spell:words("exori")
spell:level(35)
spell:mana(115)
spell:cooldown(4 * 1000)
spell:groupCooldown(2 * 1000)
spell:register()
```
## Requirements

- Windows
- Rust toolchain (stable)
- Tauri prerequisites for Windows (MSVC, WebView2)

## How to Run

### Using the build script (recommended)

- Portuguese: run `build_pt.bat`
- English: run `build_eng.bat`

Choose an option:
- Fast Build (Incremental)
- Clean and Build (Full)
- Run in DEV
- Test Release (.exe)
- Clean Only

### Build outputs (Windows)

After a successful build, you will find:
- Portable executable:
  - `src-tauri\target\release\spell-converter.exe`
  - Run directly without installing
- Installer (MSI):
  - `src-tauri\target\release\bundle\msi\Spell Converter_1.0.0_x64_en-US.msi`
  - Installs the app on your PC with Start Menu entry and uninstall support
- Installer (NSIS setup):
  - `src-tauri\target\release\bundle\nsis\Spell Converter_1.0.0_x64-setup.exe`
  - Classic setup wizard installer

Pick one:
- Quick use → double-click `spell-converter.exe`
- Install on your PC → run the MSI or the NSIS setup

### Manual

```bash
cd src-tauri
cargo tauri dev
# or
cargo tauri build
```

## Usage

1. Open the app
2. Click “Escolher Pasta” / “Choose Folder” and select the folder containing `spells.xml`
3. Set Base ID if needed (default `100`)
4. Click “Converter RevScripts”
5. Generated files are placed under `converter/` following the folder rules above

## Deployment (Install on your OT server)

After clicking “Converter RevScripts”, open the output folder:
- Default output root: `converter/`
- Optionally rename `converter/` to `spells/` if your server expects that name

Copy the generated scripts to your server:
- Spells (instant): `converter/spells/{group}/...` → place under your server `data/scripts/spells/`
- Runes: `converter/runes/{group}/...` → place under `data/scripts/runes/` (or your runes script folder)
- Conjuring: `converter/conjuring/...` → place under `data/scripts/spells/` (they are `Spell("instant")` with words)

Notes:
- Keep folder structure by group (attack, support, healing) or flatten if your server expects a flat layout
- RevScript files already call `spell:register()`, so no XML registration is required
- If your distribution uses a different RevScript root, adjust paths accordingly (e.g., `data/scripts/`)

### Instalação (PT-BR)

Depois de clicar em “Converter RevScripts”, abra a pasta de saída:
- Raiz padrão: `converter/` (você pode renomear para `spells/` se seu OT exigir)

Copie os scripts para seu servidor:
- Spells normais: `converter/spells/{group}/...` → `data/scripts/spells/`
- Runes: `converter/runes/{group}/...` → `data/scripts/runes/`
- Conjuração: `converter/conjuring/...` → `data/scripts/spells/`

Observações:
- Mantenha a estrutura por grupos ou ajuste conforme o seu OT
- Os RevScripts já fazem `spell:register()`, não precisa cadastrar no XML

## Contributing

Pull requests are welcome. Just make sure you are using English language.

### How to Contribute

- Fork the project
- Create a feature branch: `git checkout -b feature/new-feature`
- Commit your changes: `git commit -am 'Add new feature'`
- Push the branch: `git push origin feature/new-feature`
- Open a Pull Request

### Como Contribuir

- Fork o projeto
- Crie uma branch para sua feature: `git checkout -b feature/nova-feature`
- Commit suas mudanças: `git commit -am 'Adiciona nova feature'`
- Push para a branch: `git push origin feature/nova-feature`
- Abra um Pull Request

Suggested areas to improve:
- Support for additional XML attributes and edge cases
- Better handling of special groups (custom, house, party)
- More validations for duplicate words and conflicting IDs
- Additional language strings (EN/PT) for footer and badges
- Optional export formats or script naming strategies

Workflow:
- Fork the repo
- Create a topic branch
- Add tests or reproducible examples when possible
- Open a PR describing the change and reasoning in English

## Notes

- Secrets or keys should never be committed
- Generated Lua scripts follow RevScript conventions
- The tool aims to minimize manual adjustments while staying compatible with legacy combat code
